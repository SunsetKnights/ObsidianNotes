### 主存储器
##### 构成
广义的主存由主板上的ROM芯片+主存储器构成
主存储器需要的引脚数 = 地址线（==注意DRAM地址线减半的问题==）+数据线+读写线+片选线
##### DRAM芯片和SRAM芯片的核心区别
- DRAM特点：
	- 使用栅极电容存储信息
	- 是破坏性读出，读出后应有重写操作
	- 速度更慢、集成度更高、存储成本更低
	- 需要刷新（给电容重新充电）
	- 行列地址分两次送
	- 常用于主存
- SRAM特点：
	- 使用双稳态触发器存储信息
	- 非破坏性读出，无需重写
	- 速度更快、集成度更低、存储成本更高
	- 无需刷新
	- 行列地址同时送
	- 常用于cache
##### DRAM的二维排列
- 为了减少地址线数量，将存储单元从一维排列变为二维排列，而后将行列地址分开传送，这样地址线可以减少一半
- 为了让地址线尽可能少，行列数量最好一致，这样行列地址线数量是一致的
- 如果无法一致，那么为了减少刷新开销，行数应尽可能少
##### DRAM的刷新
- 按行刷新，一般2ms刷新一次
- 硬件先读取一行的信息，然后重新写入，完成刷新
##### 各类ROM
- MROM（Mask Read Only Memory）：厂家写入数据，无法修改
- PROM（Programming Read Only Memory）：使用专门的设备一次性写入，之后无法修改
- EPROM（Erasable Programming Read Only Memory）：可进行多次擦写，分为两类：
	- UVEPROM（Ultraviolet Rays Erasable Programming Read Only Memory）：用紫外线擦写，一次性擦除所有数据
	- EEPROM（Electrically Erasable Programming Read Only Memory）：可擦除特定的字
- Flash Memory：闪存芯片，在EEPROM基础上发展而来，可进行多次快速擦除重写，作为U盘、sd卡等存储介质的芯片
- SSD（Solid State Drives）：由控制单元+存储单元（Flash芯片）构成，可进行多次快速擦除重写
##### 多体并行存储器
DRAM读取之后需要恢复时间，而且往往恢复时间要比读取时间更长，假设读取时间是r，恢复时间是4r，那么存取周期为4r，由于计算机大多数时候采用顺序读取，那么：
- 高位交叉编址： 用地址的高位来区分存储体，比如有4个存储体，那么用高2位来区分不同存储体，顺序读写时，由于连续地址在同一个存储体内，那么考虑到恢复时间，这种编址的读取效率相对较低
- 低位交叉编址： 用地址的低位来区分存储体，连续的地址存放在不同的存储体内，读取效率相对更高
由上述可知，低位交叉编址效率更高，且每次访问一个存储体，等待其他存储体恢复，形成一个流水线式的并行存取，为了保证流水线不冲突且不空闲，存储体数量=T/r
### 存储器和CPU的连接
##### 存储器的引脚
- $A_0\sim A_n$：地址线引脚，总共需要$n=\log_2N$条，其中$N$是地址总数
- $D_0\sim D_n$：数据线引脚，数量=存储单元的位数
- $CS/\overline{CS}/CE/\overline{CE}$：片选线引脚，表示高电平或低电平可用
- $\overline{WE}/\overline{WR}$：读写线引脚，高电平表示读，低电平表示写，或者分开用$\overline{WE}/\overline{OE}$两根读写线
##### 位扩展
- 用于存储芯片的位数<CPU每次能访问的位数
- 新增存储芯片的地址线接入CPU的地址线（所有片一致）
- 新增存储芯片的数据线接入CPU数据线的高位
- 新增存储芯片的片选线接入高电平（所有片一致）
- 新增存储芯片的读写线接入CPU的读写线（所有片一致）
##### 字扩展
- 用于CPU每次读写的位数和存储芯片位数相同，但是CPU地址线有空闲的情况
- 译码片选法：
	- CPU的高位地址线接入一个译码器
	- 新增存储芯片的地址线接入CPU的低位地址线（所有片一致）
	- 新增存储芯片的数据线接入CPU数据线（所有片一致）
	- 新增存储芯片的片选线接入译码器
	- 新增存储芯片的读写线接入CPU的读写引脚（所有片一致）
- 线选法
	- 让每条高位的地址线接入一个片的片选线，傻逼才用
##### 字位扩展
先把一组存储芯片进行字扩展，之后把这组芯片看成一个整体，进行位扩展
### 外部存储器
#### 机械硬盘
##### 基本术语
- 盘面：一个机械硬盘往往有多个盘面
- 磁道（柱面）：盘面上的磁头划过的一个个圆
- 扇区：一个盘面分割为一个个扇区
##### 性能指标
- 记录密度
	- 道密度：一个片面的磁道数
	- 位密度：磁道单位长度能记录的二进制位数（要保证每个磁道记录的二进制位数相同，所以靠近圆心的磁道位密度高，远离圆心的磁道位密度低）
	- 面密度：位密度$\times$道密度
- 磁盘容量：
	- 非格式化容量 = 盘面数$\times$柱面（磁道）数$\times$每个磁道的磁化单元数
	- 格式化容量 = 盘面数$\times$柱面（磁道）数$\times$扇区数$\times$扇区容量
- 存取时间
	- 存取时间由寻道时间（磁头移动到磁道上的时间）、旋转延迟时间（盘面将指定扇区旋转到磁头下的时间）和传输时间（传输数据所花费的时间）构成
	- 由于寻道时间和旋转延迟时间不确定，算平均值时可以取数学期望值，即：寻道时间取磁头从最内道移动到最外道的时间的一半，旋转延迟时间取盘面旋转半周的时间
- 传输速率
	- 设磁盘转速为r，每条磁道的容量为N，那么数据传输率为$D_r=r\cdot N$
- 磁盘地址
	- 柱面（磁道）号 + 盘面号 + 扇区号
- 工作过程
	- 分为两个步骤：取控制字、执行控制字
	- 穿行操作，不能同时读写，也不能同时读或写超过一组数据
#### 固态硬盘
![[固态硬盘导图.png]]

### 高速缓冲存储器（Cache）
##### Cache可以改善访存时间的理论依据
- 时间局部性：未来要用到的代码或数据，可能是当前正在使用的代码或数据，这个叫时间局部性
- 空间局部性：未来要用到的代码或数据，可能跟当前正在使用的代码或数据相邻
- 因此，可以把当前使用的数据和代码以及相邻的数据和代码放到Cache里面
##### 平均访存时间
设访问Cache的时间为$t_c$，访问内存的时间为$t_m$，Cache命中率为$H_c$，那么平均访存时间（也即访存时间的期望值）为：
- 先访问Cache再访问主存：$t=t_c\cdot H_c+(t_m+t_c)\cdot (1-H_c)$
- Cache和主存同时访问：$t=t_c\cdot H_c+t_m\cdot (1-H_c)$
##### Cache和主存的相连方式
主存的内容放到Cache时，按块存放，把主存和Cache分成大小相等的块，对于主存的块放入Cache的哪一块这个问题，分出了不同的相连方式：
1. 全相联：任意一块主存的数据可以被放入任意一块Cache，硬件需要记录Cache块内存放的内存块号，还要记录是否有效